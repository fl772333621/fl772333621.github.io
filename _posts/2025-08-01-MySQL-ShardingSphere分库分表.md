---
layout: post
title: "MySQL-ShardingSphere分库分表"
subtitle: "Typora常用姿势总结"
date: 2025-08-01 09:40:00
author: "MengWei"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
  - MySQL
  - ShardingSphere
  - 分库分表
---

# MySQL-ShardingSphere分库分表

## 一、搭建主从集群

### 1、理论基础

主从架构有什么用？通过搭建 MySQL 主从集群，可以缓解 MySQL 的数据存储以及访问的压力。<br />
原则上，读写分离不一定必须要做，但是主从架构和高可用架构则是必须要搭建的。

- 数据安全
    - 给主服务器增加一个数据备份，当主服务器出现故障时，可以切换到从服务器，保证数据安全。
- 读写分离
    - 主服务器负责写，从服务器负责读，可以减轻主服务器的压力。
    - 大部分业务是写少读多，所以读写分离可以提高性能。
- 故障转移-高可用
    - 主服务器宕机后，可以由一台从服务器切换为主服务器，保证服务不中断。
    - 高可用架构需要依赖一些中间件来实现主从切换，如 MMM/MHA/MGR 等。

### 2、同步的原理

MySQL 的主从同步是基于二进制日志（binlog）实现的。

- 主服务器上打开 binlog 记录每一步的数据库操作
- 然后从服务器连接到主服务器后，从服务器会启动一个 I/O 线程，向主服务器发送请求读取二进制日志
- 主服务器会有一个 IO dump 线程，负责将 binlog 传输给从服务器
- 从服务器的 IO 线程会将接收到的 binlog 日志数据写入到自己的中继日志（relay log）中
- 从服务器上开启一个 SQL 线程，从 relay log 中读取二进制日志，并解析成具体的操作，来实现主从服务器的数据同步

备注：<br />
binlog 不仅可以用于主从同步，还可以用于缓存数据同步等场景，例如 Canal 就是基于 binlog 实现的。<br />
实现原理：Canal 模拟一个 slave 节点，向主服务器发起 binlog 同步，然后将数据落地到 redis/kafka 等中间件，实现数据实时流转。


### 3、搭建主从集群
